- name: "Download {{ item.file_name }}"
  get_url:
    url: "{{ webserver_url }}/{{ item.file_name }}"
    dest: "/tmp/{{ item.file_name }}"

- name: "Get  {{ item.file_name }} sha information"
  stat:
    path: "/tmp/{{ item.file_name }}"
    checksum_algorithm: sha256
  register: file_name_sha

- name:
  debug:
    var: file_name_sha
  failed_when: item.file_sha != file_name_sha.stat.checksum

- name:
  debug:
    msg: "SHA256 matches"
  when: file_name_sha.stat.checksum == item.file_sha

- name: "Copy {{ item.file_name }} to  vcenter datastore"
  vsphere_copy:
    hostname: '{{ vcenter_hostname }}'
    username: '{{ vcenter_username }}'
    password: '{{ vcenter_password }}'
    validate_certs: '{{ vm_validate_certs }}'
    src:  "/tmp/{{ item.file_name }}"
    datacenter: "{{ datacenter }}"
    datastore: "{{ datastore }}"
    path: "{{ folder_name}}/{{ item.file_name }}"
  delegate_to: localhost
